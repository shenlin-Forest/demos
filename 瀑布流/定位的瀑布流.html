<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>task44</title>
<style>
*{ margin:0; padding:0;}
li{ list-style:none;}

#div1 { 
	width:996px;
	height:auto; 
	margin:20px auto; 
	position:relative;
}
li{ 
	position:absolute;
}
#model {
	width:100%;
	height: 100%;
	background-color: #000;
	filter:alpha(opacity:70);
	opacity: 0.7;
	display: none;
	position: relative;
}
body{
	position: relative;
}
#big_pic img{
	position: absolute;
	filter:alpha(opacity:100);
	opacity: 1;
	cursor:default;
/*	left :50%;
	top:50%;*/
}
</style>
<script type="text/javascript" src="new_ajax.js"></script>
<script>
window.onload  = function(){
	var oDiv = document.getElementById('div1');
	var oBig = document.getElementById('big_pic');
	var model = document.getElementById('model');
	var height=0;
	var scrollTop=0;

	var aLi = document.getElementsByTagName('li');
	var aHeight = {L:[],C:[],R:[],F:[]};
	
	for(var i=0;i<aLi.length;i++){
		var iNow = i%4;
		
		switch(iNow){
			case 0:
				aLi[i].style.left = '16px';
				aHeight.L.push(aLi[i].offsetHeight);
				
				var step = Math.floor(i/4);
				
				//第一层
				if(!step){
					aLi[i].style.top = 0;
				}
				else{
					var sum = 0;
					for(var j=0;j<step;j++){
						sum += aHeight.L[j] + 16;
					}
					aLi[i].style.top = sum + 'px';
				}
			break;

			case 1:
				aLi[i].style.left = '273px';
				aHeight.C.push(aLi[i].offsetHeight);
				
				var step = Math.floor(i/4);
				
				if(!step){
					aLi[i].style.top = 0;
				}
				else{
					var sum = 0;
					for(var j=0;j<step;j++){
						sum += aHeight.C[j] + 16;
					}
					aLi[i].style.top = sum + 'px';
				}
			break;
			case 2:
				aLi[i].style.left = '530px';
				aHeight.R.push(aLi[i].offsetHeight);
				
				var step = Math.floor(i/4);
				
				if(!step){
					aLi[i].style.top = 0;
				}
				else{
					var sum = 0;
					for(var j=0;j<step;j++){
						sum += aHeight.R[j] + 16;
					}
					aLi[i].style.top = sum + 'px';
				}
			break;
			case 3:
				aLi[i].style.left = '787px';
				aHeight.F.push(aLi[i].offsetHeight);
				
				var step = Math.floor(i/4);
				
				if(!step){
					aLi[i].style.top = 0;
				}
				else{
					var sum = 0;
					for(var j=0;j<step;j++){
						sum += aHeight.F[j] + 16;
					}
					aLi[i].style.top = sum + 'px';
				}
			break;
		}
		
		//点击触发模态
		this.onclick = function(ev){
			var top=0;
			var ev = ev || window.event;
			var target = ev.target || ev.srcElement;
			var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
			var clientX = document.documentElement.clientWidth|| document.body.clientWidth;
			var clientY = document.documentElement.clientHeight|| document.body.clientHeight;
			// console.log(target.tagName.toLowerCase());
			// console.log(target.src);
			// console.log(this.offsetHeight);
			// console.log(target.offsetHeight);

			if(target.tagName.toLowerCase() == 'img'){
				top = document.body.scrollHeight;//网页正文全文高： document.body.scrollHeight
				model.style.height = top +'px' ;
				model.style.display  = 'block';

				oBig.innerHTML = '';
				var oImg = document.createElement('img');
				oImg.src =target.src;
				oImg.style.height = clientY -50 + 'px';
				// oImg.style.width = Math.floor(target.offsetWidth * 1.5) + 'px';
				// oImg.style.height = Math.floor(target.offsetHeight * 1.5) + 'px';
				oImg.style.width = target.offsetWidth/target.offsetHeight * (clientY -50) + 'px'; 
				oImg.style.opacity = 1;
				oImg.style.filter = 'alpha(opacity:'+100+')';

				oImg.style.left = Math.floor(clientX/2)+ 'px';
				oImg.style.top = Math.floor(clientY/2)+scrollTop + 'px';
				// oImg.style.marginLeft = -Math.floor(target.offsetWidth * 1.5/2 )+ 'px';
				// oImg.style.marginTop = -Math.floor(target.offsetHeight * 1.5/2 )+ 'px';
				oImg.style.marginLeft = -Math.floor((target.offsetWidth/target.offsetHeight * (clientY -50))/2) + 'px';
				oImg.style.marginTop = - Math.floor((clientY -50)/2) + 'px';

				oBig.appendChild(oImg);

				oImg.onclick = function(ev){
					var ev = ev || window.event;
					ev.preventDefault();
					ev.returnValue = false;
					oImg.onclick = null;
					return null;
				}
			}

		}

		model.onclick = function(){
			model.style.display = 'none';
			oBig.innerHTML = '';
		}
		
	}
	
};

</script>
</head>

<body>
<div id="div1">
	<ul>
    	<li>
        	<img src="img/1.jpg" />
            <p>这是第1张图片</p>
        </li>
        <li>
        	<img src="img/2.jpg" />
            <p>这是第2张图片</p>
        </li>
        <li>
        	<img src="img/3.jpg" />
            <p>这是第3张图片</p>
        </li>
    	<li>
        	<img src="img/4.jpg" />
            <p>这是第4张图片</p>
        </li>
        <li>
        	<img src="img/5.jpg" />
            <p>这是第5张图片</p>
        </li>
        <li>
        	<img src="img/6.jpg" />
            <p>这是第6张图片</p>
        </li>
        <li>
        	<img src="img/7.jpg" />
            <p>这是第7张图片</p>
        </li>
    	<li>
        	<img src="img/8.jpg" />
            <p>这是第8张图片</p>
        </li>
        <li>
        	<img src="img/9.jpg" />
            <p>这是第9张图片</p>
        </li>
        <li>
        	<img src="img/10.jpg" />
            <p>这是第10张图片</p>
        </li>
    	<li>
        	<img src="img/11.jpg" />
            <p>这是第11张图片</p>
        </li>
        <li>
        	<img src="img/12.jpg" />
            <p>这是第12张图片</p>
        </li>
        <li>
        	<img src="img/13.jpg" />
            <p>这是第13张图片</p>
        </li>
            	<li>
        	<img src="img/14.jpg" />
            <p>这是第14张图片</p>
        </li>
        <li>
        	<img src="img/15.jpg" />
            <p>这是第15张图片</p>
        </li>
  		 <li>
        	<img src="img/16.jpg" />
            <p>这是第16张图片</p>
        </li>
    </ul>
</div>

<div id="model">
	
</div>
<div id="big_pic">
		
</div>
</body>
</html>
